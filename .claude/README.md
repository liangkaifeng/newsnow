# Claude Code 配置说明

这是 CapitalFlow 项目的 Claude Code 自定义配置，用于优化 AI 辅助开发体验。

## 配置文件

### `.claude/instructions.md`
**自定义提示词** - 定义 Claude 的行为准则和工作方式

**核心原则**:
- 🚀 **积极主动**: 不只执行命令，要主动思考、建议、优化和预防
- ⚡ **简单高效**: 优先使用已有技术栈，最小可行方案，避免过度设计
- 💰 **低成本优先**: 优先开源方案，充分利用免费额度，成本透明
- 📋 **Spec Kit 流程**: 需求分析 → 技术方案 → E2E 测试 → 实现 → 验证 → 文档
- ✅ **E2E 测试优先**: 开发前搭建测试，开发中编写测试，测试通过才提交

**交互规范**:
- 所有交互使用**中文**
- 简洁明了，结构化输出
- **提供多方案时，必须给出默认推荐选项**（基于高效、快速、低成本原则）
- 主动反馈进度，透明决策过程

## Slash Commands

### `/plan` - 规划新功能
创建完整的 Spec 文档，包含：
- 需求分析和用户故事
- 技术架构设计
- 数据库和 API 设计
- 实施计划和成本估算

**使用场景**: 开始开发新功能前

**示例**:
```
/plan
我想添加一个用户自选股功能，能添加、删除和查看自选股票
```

---

### `/implement` - 实施功能
按照 Spec 文档逐步实施功能

**使用场景**: Spec 文档完成后，开始实际开发

**执行流程**:
1. 创建 Todo List（任务清单）
2. 逐步实施（后端 → 前端 → 测试）
3. E2E 测试优先（每个模块完成后立即测试）
4. 代码审查
5. 提交并推送

**示例**:
```
/implement
开始实施功能需求系统
```

---

### `/review` - 代码审查
全面审查代码质量、性能和安全性

**检查项**:
- ✅ 代码质量（类型安全、规范、可维护性）
- ⚡ 性能优化（前端、网络、数据库）
- 🔒 安全性（XSS、SQL 注入、CSRF、认证授权）
- 🎨 用户体验（交互、响应式、无障碍）
- ✅ 测试覆盖（E2E、单元测试）
- 💰 成本控制（资源使用、AI 成本）
- 📚 文档完整性

**使用场景**: 功能开发完成后、部署前

**示例**:
```
/review
审查最近的代码变更
```

---

### `/optimize` - 性能/成本优化
优化项目的性能、成本和用户体验

**优化维度**:
- ⚡ **性能优化**: Lighthouse > 90, 首屏 < 2s, API < 500ms
- 💰 **成本优化**: 总成本 < ￥200/月，充分利用免费额度
- 🎨 **用户体验优化**: 流畅、友好、无障碍

**使用场景**: 定期优化（每月一次）、性能/成本问题出现时

**示例**:
```
/optimize
帮我优化一下性能和成本
```

---

### `/diagnose` - 问题诊断
快速诊断项目问题（错误、性能、配置）

**诊断范围**:
- 📦 构建和依赖（依赖冲突、构建失败）
- 🔍 代码质量（ESLint、TypeScript 错误）
- ✅ 测试状态（E2E 测试通过率）
- 🐛 运行时错误（浏览器、服务器日志）
- ⚡ 性能问题（Lighthouse、加载时间）
- ⚙️  配置问题（环境变量、部署配置）
- 🔒 安全问题（依赖漏洞、敏感信息）

**使用场景**: 遇到问题时、部署前、定期检查（每周一次）

**示例**:
```
/diagnose
页面加载很慢，帮我看看是什么问题
```

## 使用示例

### 场景 1: 开发新功能

```bash
# Step 1: 规划
/plan
我想添加一个新闻收藏功能

# Step 2: 审查 Spec 文档
# Claude 会创建 .specs/news-bookmark.md
# 你审查文档，确认方案

# Step 3: 开始实施
/implement
开始实施新闻收藏功能

# Step 4: 代码审查
/review
审查新闻收藏功能的代码

# Step 5: 优化（可选）
/optimize
优化新闻收藏功能的性能
```

### 场景 2: 解决问题

```bash
# Step 1: 诊断问题
/diagnose
E2E 测试失败了

# Step 2: 修复问题
# Claude 会分析问题并提供解决方案

# Step 3: 验证修复
# 运行 pnpm test:e2e 验证
```

### 场景 3: 定期维护

```bash
# 每周一次
/diagnose
做一次全面的健康检查

# 每月一次
/optimize
优化性能和成本

/review
审查整体代码质量
```

## 开发工作流

### 标准流程（新功能）

```mermaid
graph TD
    A[用户提出需求] --> B[/plan 创建 Spec]
    B --> C[审查并确认方案]
    C --> D[/implement 开始实施]
    D --> E[编写 E2E 测试]
    E --> F[实现功能代码]
    F --> G[运行测试验证]
    G --> H{测试通过?}
    H -->|否| F
    H -->|是| I[/review 代码审查]
    I --> J{审查通过?}
    J -->|否| F
    J -->|是| K[提交并推送]
    K --> L[部署]
```

### 快速流程（Bug 修复）

```mermaid
graph TD
    A[发现 Bug] --> B[/diagnose 诊断]
    B --> C[定位问题]
    C --> D[编写测试用例]
    D --> E[修复 Bug]
    E --> F[验证测试通过]
    F --> G[提交并推送]
```

## 配置技巧

### 1. 多方案选择
当 Claude 提供多个方案时，会自动推荐最优方案（基于高效、快速、低成本原则）：

```markdown
## 方案选项

### 方案 1: Cloudflare D1 (✅ 推荐)
- 成本: ￥0/月
- 实施时间: 2 小时
- **推荐理由**: 免费且够用

### 方案 2: Supabase
- 成本: ￥50/月
- 实施时间: 4 小时

**Agent 推荐**: 方案 1
**如果你同意，我将立即开始实施。**
```

### 2. 主动性控制
Claude 会主动：
- ✅ 发现代码可以优化时，主动建议
- ✅ 看到潜在问题时，主动预防
- ✅ 有更好方案时，主动提出
- ❌ 不会擅自修改代码（会先询问）

### 3. 成本意识
每个方案都会标注：
- 💰 开发成本（需要多少时间）
- 💰 运营成本（每月多少钱）
- 💰 维护成本（容易维护吗）
- 💰 扩展成本（用户增长后的成本）

## 项目目标

### 当前阶段（已完成）
- ✅ E2E 测试基础设施
- ✅ 项目规划文档（Spec Kit）

### 下一步（进行中）
- 🔄 功能需求系统
- ⏸️ 用户认证和投票

### 未来计划
- ⏸️ AI 新闻聚合
- ⏸️ 开源数据集成（AKShare）
- ⏸️ MCP 协议支持

## 常见问题

### Q: 如何修改 Claude 的行为？
A: 编辑 `.claude/instructions.md` 文件，然后重新加载配置。

### Q: 如何添加自定义命令？
A: 在 `.claude/commands/` 目录创建新的 `.md` 文件，遵循现有格式。

### Q: 如何临时覆盖默认行为？
A: 在对话中明确告诉 Claude，例如：
```
这次我想使用方案 2（Supabase），不用推荐的方案 1
```

### Q: Claude 太主动怎么办？
A: 在对话中说：
```
这次只回答我的问题，不要主动建议
```

或修改 `.claude/instructions.md` 调整主动性。

## 维护

### 定期检查（推荐）
- **每天**: 开发前运行 `/diagnose`（快速检查）
- **每周**: 运行完整的 `/diagnose` + `/review`
- **每月**: 运行 `/optimize`（性能和成本优化）

### 更新配置
当项目需求变化时，更新相应的配置文件：
- 技术栈变化 → 更新 `instructions.md`
- 新增常用任务 → 添加 slash command
- 工作流程变化 → 更新 commands

---

**最后更新**: 2025-01-09
**维护者**: @liangkaifeng
